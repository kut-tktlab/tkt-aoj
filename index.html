<html>
<head>
<title>AOJ Scoreboard for Takata Lab</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>
// The following code is partly cited from:
// http://www.ezgate-mt.sakura.ne.jp/jquery/109.html

var userList = [
  'shioshiota',  // a sample user of AOJ
  'ytakata',
  'nyamadori',
  'FSharper',
  'fuka88k',
];

var aojurl = 'http://judge.u-aizu.ac.jp/onlinejudge';

// bootstrap
$(function () {
  loadAllUsers();
});

function loadAllUsers() {
  for (var i = 0; i < userList.length; i++) {
    loadUserData(userList[i]);
  }
}

// Load the data of one user via the AOJ API.
// AOJ API is documented at: http://judge.u-aizu.ac.jp/onlinejudge/api.jsp
function loadUserData(user) {
  var aojapiurl = aojurl + '/webservice/user?id=';
  $.ajax({
    url: aojapiurl + user,
    type: 'GET',
    dataType: 'xml',
    timeout: 1000,
    success: parseUserData
  });
}

function parseUserData(xml, status) {
  if (status != 'success') { return; }

  var user = $(xml).children('user');
  var status = user.children('status');
  var solved = user.children('solved_list');
  
  var last = null;
  if (solved != null) {
    solved.children('problem').each(function () {
      if (last == null ||
          Number(last.children('submissiondate').text())
        < Number($(this).children('submissiondate').text()))
      {
        last = $(this);
      }
    });
  }

  $('<tr>' +
      '<td>' + printUser(user.children('id').text()) + '</td>' +
      '<td ' + printGraph(status.children('solved').text()) + '</td>' +
      '<td>' +
         (last == null ? '' :
         '(' + printProblem(last.children('id').text()) +
         ' ' + last.children('language').text() +
         ' ' + printDate(last.children('submissiondate').text()) +
         ')') +
      '</td>' +
    '</tr>').appendTo('table.scoreboard tbody');
}

// Display a horizontal bar graph using CSS border-left.
function printGraph(nSolved) {
  return ' style="' +
           'border-left: solid ' + nSolved + 'px #4bf;' +
           'padding-left: 5px;' +
         '" class="graph">' + nSolved;
}

function printUser(id) {
  var aojuserurl = aojurl + '/user.jsp?id=' + id + '#1';
  return '<a href="' + aojuserurl + '">' + id + '</a>';
}

function printProblem(id) {
  var aojproburl = aojurl + '/description.jsp?id=' + id;
  return '<a href="' + aojproburl + '">#' + id + '</a>';
}

function printDate(time) {
  var d = new Date(Number(time));
  return d.getFullYear() + '/' + (d.getMonth() + 1) + '/' + d.getDate() +
         ' ' + d.getHours() + ':' + d.getMinutes();
}
</script>
<style type="text/css">
  table.scoreboard tr th {
    text-align: left;
    background: #eee;
  }
  table.scoreboard tr td#graph {
    padding-right: 5px;
  }
</style>
</head>
<body>
  <h1>AOJ Scoreboard</h1>
  <h2># of solved problems</h2>
  <table class="scoreboard">
  <tbody>
  <tr>
    <th>id</th>
    <th>solved</th>
    <th>last problem, language, and date</th>
  </tr>
  </tbody>
  </table>

  <h2>Links</h2>
  <ul>
    <li><a href="http://judge.u-aizu.ac.jp/onlinejudge/index.jsp"
           >AOJ: Aizu Online Judge</a>
      <ul>
        <li><a href="http://judge.u-aizu.ac.jp/onlinejudge/api.jsp"
               >Application Program Interface</a></li>
        <li><a href="http://aoj-problem-category-list.appspot.com"
               >AOJ Problems by Category</a> (third party site)</li>
      </ul>
    </li>
    <li><a href="http://www.info.kochi-tech.ac.jp/y-takata/index.php?Local%2FAOJ"
           >Takatalab - Local/AOJ</a>
    </li>
  </ul>

  <h2>Note</h2>
  The source code of this Web site is hosted by <a href="https://github.com/"
  >GitHub</a>.
  Please contact ytakata for becoming a contributer.<br />
  Repository: <code><a href="https://github.com/ytakata69/tkt-aoj/"
  >https://github.com/ytakata69/tkt-aoj/</a></code><br />
  When you push a change to the above repository,
  it will be automatically deployed on the Azure Websites.
</body>
</html>
